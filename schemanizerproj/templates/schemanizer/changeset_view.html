{% extends 'site_base.html' %}
{% load crispy_forms_tags %}

{% block title %}{{ block.super }} - Changeset{% endblock %}

{% block contents %}
    {% if user_has_access %}
        <p><strong>Changeset</strong></p>
        <table class="table table-striped table-condensed table-bordered table-hover">
            <tbody>
                <tr>
                    <th>ID:</th>
                    <td>{{ changeset.id }}</td>
                </tr>
                <tr>
                    <th>Type:</th>
                    <td>{{ changeset.type }}</td>
                </tr>
                <tr>
                    <th>Classification:</th>
                    <td>{{ changeset.classification }}</td>
                </tr>
                <tr>
                    <th>Version control URL:</th>
                    <td>{{ changeset.version_control_url }}</td>
                </tr>
                <tr>
                    <th>Submitted by:</th>
                    <td>{{ changeset.submitted_by }}</td>
                </tr>
                <tr>
                    <th>Submitted at:</th>
                    <td>{{ changeset.submitted_at }}</td>
                </tr>
                <tr>
                    <th>Review status:</th>
                    <td>{{ changeset.review_status|default_if_none:'' }}</td>
                </tr>
                <tr>
                    <th>Reviewed by:</th>
                    <td>{{ changeset.reviewed_by|default_if_none:'' }}</td>
                </tr>
                <tr>
                    <th>Review at:</th>
                    <td>{{ changeset.reviewed_at|default_if_none:'' }}</td>
                </tr>
                <tr>
                    <th>Approved by:</th>
                    <td>{{ changeset.approved_by|default_if_none:'' }}</td>
                </tr>
                <tr>
                    <th>Approved at:</th>
                    <td>{{ changeset.approved_at|default_if_none:'' }}</td>
                </tr>
                <tr>
                    <th>Created at:</th>
                    <td>{{ changeset.created_at }}</td>
                </tr>
                <tr>
                    <th>Updated at:</th>
                    <td>{{ changeset.updated_at }}</td>
                </tr>
            </tbody>
        </table>

        <p><strong>Changeset Details</strong></p>
        {% if changeset.changesetdetail_set.all %}
            <table class="table table-striped table-condensed table-bordered table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Type</th>
                        <th>Description</th>
                        <th>Apply SQL</th>
                        <th>Revert SQL</th>
                        <th>Before checksum</th>
                        <th>After checksum</th>
                        <th>Count SQL</th>
                        <th>Volumetric values</th>
                        <th>Created at</th>
                        <th>Updated at</th>
                    </tr>
                </thead>
                <tbody>
                    {% for detail in changeset.changesetdetail_set.all %}
                        <tr>
                            <td>{{ detail.id }}</td>
                            <td>{{ detail.type }}</td>
                            <td>{{ detail.description }}</td>
                            <td>{{ detail.apply_sql }}</td>
                            <td>{{ detail.revert_sql }}</td>
                            <td>{{ detail.before_checksum }}</td>
                            <td>{{ detail.after_checksum }}</td>
                            <td>{{ detail.count_sql }}</td>
                            <td>{{ detail.volumetric_values }}</td>
                            <td>{{ detail.created_at }}</td>
                            <td>{{ detail.updated_at }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="text-info"><em>No changeset details.</em></p>
        {% endif %}

        <p><strong>Changeset Actions</strong></p>
        {% if changeset.changesetaction_set.all %}
            <table class="table table-striped table-condensed table-bordered table-hover">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Type</th>
                    <th>Timestamp</th>
                    <th>Created at</th>
                    <th>Updated at</th>
                </tr>
                </thead>
                <tbody>
                {% for action in changeset.changesetaction_set.all %}
                    <tr>
                        <td>{{ action.id }}</td>
                        <td>{{ action.type }}</td>
                        <td>{{ action.timestamp }}</td>
                        <td>{{ action.created_at }}</td>
                        <td>{{ action.updated_at }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="text-info"><em>No changeset actions.</em></p>
        {% endif %}

        <form method="post" action="">
            {% csrf_token %}
            <div class="form-actions">
                {% if can_review %}
                    <input type="submit" class="btn" name="submit_review" value="Revise/Review" />
                {% endif %}
                {% if can_approve %}
                    <input type="submit" class="btn" name="submit_approve" value="Approve" />
                {% endif %}
                {% if can_reject %}
                    <input type="submit" class="btn" name="submit_reject" value="Reject" />
                {% endif %}
            </div>
        </form>
    {% endif %}
{% endblock %}