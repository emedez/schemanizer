{% extends 'site_base.html' %}
{% load crispy_forms_tags %}

{% block title %}{{ block.super }} - View Changeset Apply Results{% endblock %}

{% block contents %}
    {% if user_has_access %}
        {% if form %}
            {% crispy form form.helper %}
        {% endif %}
    {% endif %}

    {% if applied_changesets %}
        <p><strong>Applied Changesets</strong></p>
        <table class="table table-striped table-condensed table-bordered table-hover">
            <thead>
            <tr>
                <th>ID</th>
                <th>Database schema</th>
                <th>Type</th>
                <th>Classification</th>
                <th>Version control URL</th>
                <th>Submitted by</th>
                <th>Submitted at</th>
                <th>Review status</th>
                <th>Reviewed by</th>
                <th>Reviewed at</th>
                <th>Approved by</th>
                <th>Approved at</th>
                <th>Created at</th>
                <th>Updated at</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody>
            {% for changeset in applied_changesets %}
                <tr>
                    <td>{{ changeset.id }}</td>
                    <td>{{ changeset.database_schema }}</td>
                    <td>{{ changeset.type }}</td>
                    <td>{{ changeset.classification }}</td>
                    <td>{{ changeset.version_control_url }}</td>
                    <td>{{ changeset.submitted_by }}</td>
                    <td>{{ changeset.submitted_at }}</td>
                    <td>{{ changeset.review_status }}</td>
                    <td>{{ changeset.reviewed_by|default_if_none:'' }}</td>
                    <td>{{ changeset.reviewed_at|default_if_none:'' }}</td>
                    <td>{{ changeset.approved_by|default_if_none:'' }}</td>
                    <td>{{ changeset.approved_at|default_if_none:'' }}</td>
                    <td>{{ changeset.created_at }}</td>
                    <td>{{ changeset.updated_at }}</td>
                    <td>
                        <a class="btn btn-small" href="{% url 'schemanizer_changeset_apply_results' schema_version.id changeset.id %}">View Results</a>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    {% endif %}
{% endblock %}