{% extends 'site_base.html' %}

{% block title %}{{ block.super }} - Changesets{% endblock %}
{% block class_changesets %}active{% endblock %}

{% block contents %}
    <h2>Changesets</h2>
    <p><a href="{% url 'schemanizer_changeset_submit' %}">Click here to submit new changeset</a></p>
    {% if changesets %}
        <table class="table table-striped table-condensed table-bordered table-hover">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Database schema</th>
                    <th>Type</th>
                    <th>Classification</th>
                    <th>Version control URL</th>
                    <th>Submitted by</th>
                    <th>Submitted at</th>
                    <th>Review status</th>
                    <th>Reviewed by</th>
                    <th>Reviewed at</th>
                    <th>Approved by</th>
                    <th>Approved at</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
            {% for c in changesets %}
                <tr>
                    <td>{{ c.r.id }}</td>
                    <td>{{ c.r.database_schema }}</td>
                    <td>{{ c.r.type }}</td>
                    <td>{{ c.r.classification }}</td>
                    <td>{{ c.r.version_control_url }}</td>
                    <td>{{ c.r.submitted_by }}</td>
                    <td>{{ c.r.submitted_at }}</td>
                    <td>{{ c.r.review_status }}</td>
                    <td>{{ c.r.reviewed_by|default_if_none:'' }}</td>
                    <td>{{ c.r.reviewed_at|default_if_none:'' }}</td>
                    <td>{{ c.r.approved_by|default_if_none:'' }}</td>
                    <td>{{ c.r.approved_at|default_if_none:'' }}</td>
                    {% comment %}
                    <td>
                        <a href="{% url 'schemanizer_changeset_view' c.r.id %}">View</a>&nbsp;&nbsp;
                        <a href="{% url 'schemanizer_changeset_view_review_results' c.r.id %}">View Review Results</a>&nbsp;&nbsp;
                        {% if can_soft_delete %}
                            <a href="{% url 'schemanizer_changeset_soft_delete' c.r.id %}">Delete</a>&nbsp;&nbsp;
                        {% endif %}
                        {% if c.extra.can_apply %}
                            <a href="javascript:void(0)">Apply</a>
                        {% endif %}
                    </td>
                    {% endcomment %}
                    <td>
                        <div class="btn-group">
                            <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
                                Action
                                <span class="caret"></span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a href="{% url 'schemanizer_changeset_view' c.r.id %}">View</a></li>
                                <li><a href="{% url 'schemanizer_changeset_view_review_results' c.r.id %}">View Review Results</a></li>
                                {% if can_soft_delete %}
                                    <li><a href="{% url 'schemanizer_changeset_soft_delete' c.r.id %}">Delete</a></li>
                                {% endif %}
                                {% if c.extra.can_apply %}
                                    <li><a href="{% url 'schemanizer_changeset_apply' c.r.id %}">Apply</a></li>
                                {% endif %}
                            </ul>
                        </div>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="text-info"><em>No changesets.</em></p>
    {% endif %}
{% endblock %}